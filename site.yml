---
- hosts: localhost
  connection: local
  gather_facts: no

  vars:
    snap_classic_pkgs:
      - code
      - kubectl

    apt_repos:
      - ppa:mmstick76/alacritty

    apt_pkgs:
      - curl
      - fish
      - alacritty
      - tmux
      - tig
    
    deb_pkgs:
      - https://storage.googleapis.com/minikube/releases/latest/minikube_1.6.2.deb
      - https://download.virtualbox.org/virtualbox/6.1.0/virtualbox-6.1_6.1.0-135406~Ubuntu~bionic_amd64.deb
          
    dotfiles:
      - { src: dotfiles/git/gitconfig,            dest: ~/.gitconfig }
      - { src: dotfiles/git/gitignore_global,     dest: ~/.gitignore_global }
      - { src: dotfiles/alacritty/alacritty.yml,  dest: ~/.config/alacritty/alacritty.yml }
      - { src: dotfiles/tmux/tmux.conf,           dest: ~/.tmux.conf }
      - { src: dotfiles/fish/,                    dest: ~/.config/fish/ }

  tasks:
  - name: Ensure workspace directory
    file:
      path: ~/workspace
      state: directory
      
  - name: Install snaps
    become: yes
    snap:
      name: "{{ item }}"
      classic: yes
    loop: "{{ snap_classic_pkgs }}"	

  - name: Add apt repos
    become: yes
    apt_repository:
      repo: "{{ item }}"
      state: present
      update_cache: yes
    loop: "{{ apt_repos }}" 
      
  - name: Install apt packages
    become: yes
    apt:
      name: "{{ item }}"
      state: present
      update_cache: yes
    loop: "{{ apt_pkgs }}"

  - name: Install deb packages
    become: yes
    apt:
      deb: "{{ item }}"
    loop: "{{ deb_pkgs }}"

  - name: Ensure dotfiles dest dirs exists
    file:
      path: "{{ item.dest | dirname }}"
      state: directory
    loop: "{{ dotfiles }}"
    tags: dotfiles

  - name: Copy dotfiles
    copy:
      src: "{{ item.src }}"
      dest: "{{ item.dest }}"
    loop: "{{ dotfiles }}"
    tags: dotfiles

  # Running "fisher" without any arguments will install/update packages defined in fishfile
  - name: Install fisher packages
    command: fish -c fisher
    changed_when: false
    tags: dotfiles